# åŸºäºæŠ¥å‘Šç”Ÿæˆå›¾ç‰‡åŠŸèƒ½æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

åŸºäºå·²ç”Ÿæˆçš„å®¶æ—å†å²æŠ¥å‘Šï¼Œä½¿ç”¨å³æ¢¦4.0ï¼ˆSeedream 4.0ï¼‰AIæ¨¡å‹ç”Ÿæˆ1-2å¼ ä¸å®¶æ—å†å²ç›¸å…³çš„å›¾ç‰‡ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¨ **æ™ºèƒ½æç¤ºè¯ç”Ÿæˆ**ï¼šä½¿ç”¨ DeepSeek LLM ä»æŠ¥å‘Šä¸­æå–å…³é”®ä¿¡æ¯ï¼Œè‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡æè¿°æç¤ºè¯
- ğŸ–¼ï¸ **é«˜è´¨é‡å›¾ç‰‡**ï¼šä½¿ç”¨å³æ¢¦4.0æ¨¡å‹ç”Ÿæˆ2Kåˆ†è¾¨ç‡çš„é«˜è´¨é‡å›¾ç‰‡
- ğŸ“ **åŸºäºæŠ¥å‘Šå†…å®¹**ï¼šå›¾ç‰‡å†…å®¹ä¸å®¶æ—å†å²æŠ¥å‘Šç´§å¯†ç›¸å…³
- ğŸ”¢ **çµæ´»æ•°é‡**ï¼šæ”¯æŒç”Ÿæˆ1-2å¼ å›¾ç‰‡
- ğŸ’¾ **è‡ªåŠ¨ä¿å­˜**ï¼šç”Ÿæˆçš„å›¾ç‰‡URLä¼šè‡ªåŠ¨ä¿å­˜åˆ°æŠ¥å‘Šä¸­

## é…ç½®è¦æ±‚

### 1. ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `backend/.env` æ–‡ä»¶ä¸­æ·»åŠ å³æ¢¦4.0 APIé…ç½®ï¼š

```env
# å³æ¢¦4.0 API é…ç½®ï¼ˆå›¾ç‰‡ç”Ÿæˆï¼‰
SEEDREAM_API_KEY=your_seedream_api_key_here
SEEDREAM_API_BASE_URL=https://api.302.ai
SEEDREAM_MODEL=doubao-seedream-4-0-250828
```

### 2. è·å– API Key

1. è®¿é—®å³æ¢¦4.0 APIæœåŠ¡æä¾›å•†
2. æ³¨å†Œè´¦å·å¹¶è·å– API Key
3. å°† Key é…ç½®åˆ° `.env` æ–‡ä»¶ä¸­

## API æ¥å£

### ç”Ÿæˆå›¾ç‰‡

**POST** `/generate/images`

åŸºäºå·²ç”Ÿæˆçš„æŠ¥å‘Šç”Ÿæˆå›¾ç‰‡ã€‚

#### è¯·æ±‚ä½“

```json
{
  "session_id": "abc123",
  "num_images": 1,  // å¯é€‰ï¼Œ1-2ï¼Œé»˜è®¤1
  "size": "2K"      // å¯é€‰ï¼Œå›¾ç‰‡åˆ†è¾¨ç‡ï¼Œé»˜è®¤"2K"
}
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| session_id | string | æ˜¯ | ä¼šè¯ID |
| num_images | integer | å¦ | ç”Ÿæˆå›¾ç‰‡æ•°é‡ï¼ŒèŒƒå›´1-2ï¼Œé»˜è®¤1 |
| size | string | å¦ | å›¾ç‰‡åˆ†è¾¨ç‡ï¼Œé»˜è®¤"2K" |

#### å“åº”ç¤ºä¾‹

```json
{
  "images": [
    "https://example.com/generated_image1.png",
    "https://example.com/generated_image2.png"
  ],
  "count": 2,
  "session_id": "abc123"
}
```

#### é”™è¯¯å“åº”

**404 - ä¼šè¯ä¸å­˜åœ¨**
```json
{
  "detail": "Session abc123 not found"
}
```

**404 - æŠ¥å‘Šä¸å­˜åœ¨**
```json
{
  "detail": "Report not found for session abc123. Please generate report first."
}
```

**400 - å‚æ•°é”™è¯¯**
```json
{
  "detail": "num_images must be between 1 and 2"
}
```

**500 - APIè°ƒç”¨å¤±è´¥**
```json
{
  "detail": "å³æ¢¦4.0 API è°ƒç”¨å¤±è´¥: 401"
}
```

## ä½¿ç”¨æµç¨‹

### å®Œæ•´æµç¨‹ç¤ºä¾‹

```bash
# 1. åˆ›å»ºä¼šè¯
curl -X POST http://localhost:8000/user/input \
  -H "Content-Type: application/json" \
  -d '{
    "name": "å¼ ä¸‰",
    "birth_date": "1990-01-01",
    "birth_place": "åŒ—äº¬",
    "current_location": "ä¸Šæµ·"
  }'

# è¿”å›: {"session_id": "abc123", ...}

# 2. è¿›è¡ŒAIé—®ç­”ï¼ˆå¤šæ¬¡è°ƒç”¨ï¼‰
curl -X POST http://localhost:8000/ai/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "abc123",
    "answer": "æˆ‘çš„ç¥–ç±æ˜¯å±±ä¸œ"
  }'

# 3. æœç´¢å®¶æ—å†å²
curl "http://localhost:8000/search/family?session_id=abc123"

# 4. ç”ŸæˆæŠ¥å‘Š
curl -X POST http://localhost:8000/generate/report \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "abc123"
  }'

# 5. åŸºäºæŠ¥å‘Šç”Ÿæˆå›¾ç‰‡
curl -X POST http://localhost:8000/generate/images \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "abc123",
    "num_images": 2,
    "size": "2K"
  }'
```

### Python ç¤ºä¾‹

```python
import requests

BASE_URL = "http://localhost:8000"

# 1. åˆ›å»ºä¼šè¯
session_response = requests.post(
    f"{BASE_URL}/user/input",
    json={
        "name": "å¼ ä¸‰",
        "birth_date": "1990-01-01",
        "birth_place": "åŒ—äº¬",
        "current_location": "ä¸Šæµ·"
    }
)
session_id = session_response.json()["session_id"]

# 2. è¿›è¡ŒAIé—®ç­”
requests.post(
    f"{BASE_URL}/ai/chat",
    json={
        "session_id": session_id,
        "answer": "æˆ‘çš„ç¥–ç±æ˜¯å±±ä¸œ"
    }
)

# 3. æœç´¢å®¶æ—å†å²
requests.get(f"{BASE_URL}/search/family?session_id={session_id}")

# 4. ç”ŸæˆæŠ¥å‘Š
requests.post(
    f"{BASE_URL}/generate/report",
    json={"session_id": session_id}
)

# 5. ç”Ÿæˆå›¾ç‰‡
image_response = requests.post(
    f"{BASE_URL}/generate/images",
    json={
        "session_id": session_id,
        "num_images": 2,
        "size": "2K"
    }
)

images = image_response.json()["images"]
print(f"ç”Ÿæˆäº† {len(images)} å¼ å›¾ç‰‡:")
for i, url in enumerate(images, 1):
    print(f"  å›¾ç‰‡ {i}: {url}")
```

## å·¥ä½œåŸç†

### 1. æŠ¥å‘Šä¿¡æ¯æå–

ç³»ç»Ÿä¼šä»æŠ¥å‘Šä¸­æå–ä»¥ä¸‹ä¿¡æ¯ï¼š
- ç”¨æˆ·å§“å
- å®¶æ—åç§°
- ä¸»è¦åœ°åŒº
- æŠ¥å‘Šæ‘˜è¦ï¼ˆå‰500å­—ï¼‰

### 2. æç¤ºè¯ç”Ÿæˆ

ä½¿ç”¨ DeepSeek LLM åŸºäºæŠ¥å‘Šå†…å®¹ç”Ÿæˆå›¾ç‰‡æè¿°æç¤ºè¯ï¼š
- è‡ªåŠ¨åˆ†ææŠ¥å‘Šå†…å®¹
- ç”Ÿæˆä¸å®¶æ—å†å²ç›¸å…³çš„åœºæ™¯æè¿°
- é£æ ¼ï¼šä¸­å›½é£ã€å†å²æ„Ÿã€æ¸©æš–ã€æœ‰æ•…äº‹æ€§
- æ¯ä¸ªæç¤ºè¯æ§åˆ¶åœ¨100å­—ä»¥å†…

### 3. å›¾ç‰‡ç”Ÿæˆ

ä½¿ç”¨å³æ¢¦4.0 APIç”Ÿæˆå›¾ç‰‡ï¼š
- è°ƒç”¨å³æ¢¦4.0 API
- æ”¯æŒ2Kåˆ†è¾¨ç‡
- ä¸æ·»åŠ æ°´å°
- è¶…æ—¶æ—¶é—´ï¼š120ç§’

### 4. ç»“æœä¿å­˜

ç”Ÿæˆçš„å›¾ç‰‡URLä¼šè‡ªåŠ¨ä¿å­˜åˆ°æŠ¥å‘Šä¸­ï¼š
- æ›´æ–°æŠ¥å‘Šçš„ `images` å­—æ®µ
- æ·»åŠ  `images_generated_at` æ—¶é—´æˆ³
- ä¿å­˜åˆ° MongoDB

## å›¾ç‰‡æç¤ºè¯ç¤ºä¾‹

ç³»ç»Ÿä¼šæ ¹æ®æŠ¥å‘Šå†…å®¹è‡ªåŠ¨ç”Ÿæˆæç¤ºè¯ï¼Œä¾‹å¦‚ï¼š

**ç¤ºä¾‹1ï¼šå®¶æ—è¿å¾™åœºæ™¯**
```
ä¸­å›½é£å®¶æ—å†å²åœºæ™¯ï¼Œå¼ ä¸‰çš„å®¶æ—ä¼ æ‰¿ï¼Œå¼ æ°å®¶æ—ï¼Œä»å±±ä¸œåˆ°åŒ—äº¬çš„è¿å¾™ä¹‹è·¯ï¼Œæ¸©æš–çš„å†å²æ°›å›´ï¼Œä¼ ç»Ÿå»ºç­‘ï¼Œå®¶æ—æˆå‘˜å½¢è±¡
```

**ç¤ºä¾‹2ï¼šå®¶æ—æ–‡åŒ–ä¼ æ‰¿**
```
å®¶æ—æ–‡åŒ–ä¼ æ‰¿åœºæ™¯ï¼Œå±±ä¸œã€åŒ—äº¬åœ°åŒºï¼Œå†å²å»ºç­‘ï¼Œå®¶æ—æ•…äº‹ï¼Œä¼ ç»ŸèŠ‚æ—¥ï¼Œå®¶æ—èšä¼šï¼Œæ¸©æš–çš„å®¶æ—æƒ…æ„Ÿ
```

**ç¤ºä¾‹3ï¼šå†å²äººç‰©å½¢è±¡**
```
å†å²äººç‰©å½¢è±¡ï¼Œå¼ æ°å®¶æ—ï¼Œå¤ä»£æ–‡äººï¼Œä¼ ç»Ÿæœé¥°ï¼Œå†å²èƒŒæ™¯ï¼Œå®¶æ—ä¼ æ‰¿ï¼Œæ–‡åŒ–åº•è•´
```

## æ³¨æ„äº‹é¡¹

1. **å¿…é¡»å…ˆç”ŸæˆæŠ¥å‘Š**ï¼šåœ¨ç”Ÿæˆå›¾ç‰‡ä¹‹å‰ï¼Œå¿…é¡»å…ˆè°ƒç”¨ `/generate/report` ç”ŸæˆæŠ¥å‘Š
2. **API Keyé…ç½®**ï¼šç¡®ä¿å·²æ­£ç¡®é…ç½®å³æ¢¦4.0 API Key
3. **å›¾ç‰‡æ•°é‡é™åˆ¶**ï¼šæœ€å¤šç”Ÿæˆ2å¼ å›¾ç‰‡
4. **è¶…æ—¶å¤„ç†**ï¼šå›¾ç‰‡ç”Ÿæˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆæ¯å¼ çº¦30-60ç§’ï¼‰ï¼Œè¯·è€å¿ƒç­‰å¾…
5. **ç½‘ç»œè¦æ±‚**ï¼šéœ€è¦èƒ½å¤Ÿè®¿é—®å³æ¢¦4.0 APIæœåŠ¡

## æŸ¥çœ‹ç”Ÿæˆçš„å›¾ç‰‡

ç”Ÿæˆçš„å›¾ç‰‡URLä¼šä¿å­˜åœ¨æŠ¥å‘Šä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š

```bash
# è·å–ä¼šè¯æŠ¥å‘Šï¼ˆåŒ…å«å›¾ç‰‡ï¼‰
curl "http://localhost:8000/session/{session_id}/report"
```

å“åº”ä¸­çš„ `report.images` å­—æ®µåŒ…å«æ‰€æœ‰ç”Ÿæˆçš„å›¾ç‰‡URLã€‚

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šAPI Keyæœªé…ç½®

**é”™è¯¯ä¿¡æ¯**ï¼š`å³æ¢¦4.0 API key not configured`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­æ˜¯å¦é…ç½®äº† `SEEDREAM_API_KEY`
2. ç¡®ä¿ API Key æ ¼å¼æ­£ç¡®
3. é‡å¯åç«¯æœåŠ¡

### é—®é¢˜2ï¼šæŠ¥å‘Šä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**ï¼š`Report not found for session {session_id}. Please generate report first.`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å…ˆè°ƒç”¨ `/generate/report` ç”ŸæˆæŠ¥å‘Š
2. ç¡®è®¤ `session_id` æ­£ç¡®

### é—®é¢˜3ï¼šAPIè°ƒç”¨è¶…æ—¶

**é”™è¯¯ä¿¡æ¯**ï¼š`å³æ¢¦4.0 API è°ƒç”¨è¶…æ—¶ï¼ˆ120ç§’ï¼‰`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. æ£€æŸ¥å³æ¢¦4.0æœåŠ¡çŠ¶æ€
3. ç¨åé‡è¯•

### é—®é¢˜4ï¼šå›¾ç‰‡ç”Ÿæˆå¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`æœªèƒ½ç”Ÿæˆä»»ä½•å›¾ç‰‡`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å³æ¢¦4.0 APIæ˜¯å¦æ­£å¸¸
2. æŸ¥çœ‹åç«¯æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤æç¤ºè¯æ˜¯å¦ç¬¦åˆè¦æ±‚

## æ€§èƒ½è¯´æ˜

- **å•å¼ å›¾ç‰‡ç”Ÿæˆæ—¶é—´**ï¼šçº¦30-60ç§’
- **ä¸¤å¼ å›¾ç‰‡ç”Ÿæˆæ—¶é—´**ï¼šçº¦60-120ç§’ï¼ˆå¹¶è¡Œç”Ÿæˆï¼‰
- **æç¤ºè¯ç”Ÿæˆæ—¶é—´**ï¼šçº¦10-20ç§’

## ç›¸å…³æ¥å£

- `POST /generate/report` - ç”Ÿæˆå®¶æ—æŠ¥å‘Š
- `GET /session/{session_id}/report` - è·å–ä¼šè¯æŠ¥å‘Šï¼ˆåŒ…å«å›¾ç‰‡ï¼‰

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-01)
- âœ… å®ç°åŸºäºæŠ¥å‘Šç”Ÿæˆå›¾ç‰‡åŠŸèƒ½
- âœ… é›†æˆå³æ¢¦4.0 API
- âœ… è‡ªåŠ¨æç¤ºè¯ç”Ÿæˆ
- âœ… å›¾ç‰‡URLè‡ªåŠ¨ä¿å­˜åˆ°æŠ¥å‘Š

---

**æœ€åæ›´æ–°**ï¼š2024-01-01
